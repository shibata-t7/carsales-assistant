# トヨタセールスAIアシスタント 機能要件仕様書

## 1. 概要

トヨタセールスAIアシスタントは、自動車販売店の営業担当者向けに、生成AIを活用して顧客情報から最適な提案内容とセールストークを生成するアプリケーションです。本プロトタイプでは、Dify APIとの連携を前提とした基本機能を実装します。

## 2. 基本機能

### 2.1 顧客情報入力機能
- 手動でのテキストエリア入力による顧客情報登録
- 顧客基本情報とニーズ情報の統合入力

### 2.2 提案内容生成機能
- 顧客情報に基づく最適な車種提案（Dify API連携）
- 顧客ベネフィットに沿った提案ポイントの表示
- 提案理由の詳細表示（各提案項目に対して）
- 提案内容の編集・保存
- 提案内容に関する質問応答機能（Dify API連携）

### 2.3 ロールプレイ機能
- セールストークのAI生成（Dify API連携）
　※顧客と担当営業の商談会話
- セールス役/顧客役のDifyアプリ連携（新規タブで開く）

### 2.4 履歴管理機能
- 過去の提案内容の一覧表示
- 顧客名による検索機能
- 期間によるフィルタリング
- 詳細情報の表示
- CSV形式でのエクスポート

### 2.5 API設定機能
- APIエンドポイントURL設定（管理者のみ）
- Dify APIキーの設定（提案生成、質問回答、セールストーク生成）（管理者のみ）
- 接続テスト機能（提案生成、質問回答、セールストーク生成）（管理者のみ）
- 設定の保存（管理者のみ）
- 一般ユーザーは管理者設定を自動参照

### 2.6 ユーザー権限管理機能
- 管理者ユーザー・一般ユーザーの権限管理
- 権限に応じたUI表示制御
- API設定の共有機能（一般ユーザーは管理者設定を参照）
- 権限ベースのアクセス制御

## 3. 画面別機能詳細

### 3.1 顧客情報入力画面

#### 基本情報セクション
- **統合テキストエリア**: 顧客の基本情報とニーズ情報を自由形式で入力
  - 入力内容の例: 氏名、年齢、家族構成、趣味・ライフスタイル、現在の車、不満点、重視する点など
- **氏名（顧客番号）**: テキスト入力フィールド（必須）

#### 顧客タイプセクション
- **タイプ選択**: ラジオボタン
  - 購入意向なし（サービスで来店）
  - 購入意向あり（車種検討済み）
  - 相見積もり（競合検討）

#### 操作ボタン
- **提案内容を生成**: 入力情報をDify APIに送信

### 3.2 提案内容画面

#### 提案詳細
- 顧客情報サマリー
- 詳細な提案内容（車種・グレード・価格）
- 支払方法の詳細
- 購入時期の提案
- 下取対応の詳細
- 各項目の詳細な提案理由

#### Q&Aセクション
- 想定される質問と回答の表示（3件）
- 質問入力フォーム
- AIによる回答生成（Dify API連携）

#### ロールプレイ
- 推奨セールストークの表示
- **セールス役**: ボタン (クリックでソースコード内に記述するDifyアプリURLを新規タブで開く)
- **顧客役**: ボタン (クリックでソースコード内に記述するDifyアプリURLを新規タブで開く)

#### 操作ボタン
- **セールストークを生成**: 入力情報をDify APIに送信
- **履歴に保存**: 推奨セールストークを履歴として保存

### 3.3 履歴画面

#### 検索・フィルターセクション
- 顧客名検索フィールド
- 期間フィルター選択
- CSVエクスポートボタン

#### 履歴テーブル
- 日時
- 顧客名
- 提案車種
- 詳細ボタン

#### ページネーション
- ページ番号表示
- 前後ページ移動ボタン

### 3.4 設定画面

#### 管理者ユーザー向け設定画面
- APIキー入力フィールド（マスク表示）
- APIエンドポイント入力フィールド
- 接続ステータス表示
- **接続テスト**: API接続テスト実行（提案生成、質問回答、セールストーク生成）
- **保存**: 設定内容の保存

#### 一般ユーザー向け制限表示
- 設定ボタン非表示
- ユーザー名クリック時に制限メッセージ表示
- 「API設定は管理者のみが変更できます」というメッセージ

### 3.5 ユーザー権限管理

#### ログイン認証
- **管理者ユーザー**: username: admin, password: admin
- **一般ユーザー**: username: demo, password: demo

#### 権限制御
- UI表示制御: 権限に応じた設定ボタンの表示/非表示
- API制御: 管理者のみAPI設定変更可能
- 設定共有: 一般ユーザーは管理者設定を自動参照

## 4. Dify API連携実装方針

### 4.1 共通仕様
- レスポンスモードはタイムアウト回避のため**ストリーミングモード**で実装する
- ワークフロー実行時の応答はChunkCompletionResponseストリームで返される
- ワークフローの進行状況をリアルタイム表示
- 段階的な結果表示によるユーザー体験向上

### 4.2 提案生成API
- サンプルコード dify_recommendreq_sample.py を参考に実装

### 4.2 質問回答API
- サンプルコード dify_qa_sample.py を参考に実装

### 4.3 セールストーク生成API
- サンプルコード dify_conversation_sample.py を参考に実装

### 4.4 API設定機能
- 接続テストは GET /info のレスポンスを確認する

## 5. 非機能要件

### 5.1 信頼性要件
- API接続エラー時の適切なエラーメッセージ表示
- 入力データの検証とエラーハンドリング

### 5.2 セキュリティ要件
- ログイン認証によるアクセス制御
- ユーザー権限管理（管理者・一般ユーザー）
- 権限ベースのAPI設定アクセス制御
- APIキーのマスク表示

### 5.4 互換性要件
- 主要Webブラウザでの動作（Chrome, Firefox, Edge）

### 5.5 運用・保守要件
- データのエクスポート機能
- 簡易的なログ出力

## 6. 前提条件・技術スタック

### 6.1 前提条件
- Dify APIが利用可能であること
- APIは顧客情報から提案内容を生成できること
- APIは提案内容に対する質問から回答を生成できること
- APIは提案内容からセールストークを生成できること
- Difyアプリで特定の役割別ロールプレイが実装されていること

### 6.2 技術スタック
#### バックエンド
- 言語: Python
- フレームワーク：Flask
- DB：SQLite
#### フロントエンド
- HTML5/CSS3/JavaScript
- フレームワーク: Bootstrap 5（レスポンシブデザイン対応）
- AJAX/Fetch API（非同期通信）